## Отчет по большому дз 3

1. Пояснение к запуску:
- Можно запустить в папке HW3 в терминале команду *docker-compose up --build*, тогда соберется общий контейнер для всех 
микросервисов, далее API каждого микросервиса будет доступно в Swagger по адресам
- - 8081 - Gateway
- - 8082 - Payment
- - 8083 - Order
2. Структура приложения:
- Gateway - сервис для перенаправления запросов в сервисы Payment и Order.
- Payment - сервис, который реализует функции создания нового счета по id покупателя, пополнение счета по id покупателя и просмотр счета по id покупателя. 
Также данный сервис реализует паттерны transactional outbox/inbox. Inbox - считывает из кафки сообщений-заказов, записывает его в таблицу inbox_events, далее обработчик (InboxProcessor) считывает все не обработанные события из этой таблицы
и обрабатывает и меняет статус обработки, также при обработке заказа создается событие на отправку результата в order (записывается в outbox_events) и далее другой обработчик (OutboxProcessor) считывает неотправленные сообщения из таблицы и отправляет в кафку, меняя статус сообщений в таблице.
Также в данном сервисе реализован подсчет баланса по записям всех транзакций (transactional_info - таблица), при вычитании стоимости заказа записи с определенным userId блокируются (пессимистическая блокировка на чтение и запись) и транзакцией проверяется можно ли списать деньги или нельзя и если можно добавляется соответствующая запись.
- Analysis - сервис, который реализует функции создания заказа, просмотр заказа по его id и просмотр всех заказов пользователей. Также при создании заказа использовался паттерн transactional outbox - новый заказ записывается
в таблицу заказов и создается событие на его обработку (записывается в таблицу outbox_event). Далее обработчик отправляет сообщения в кафку, а Listener слушает другой топик кафки для получения из payment сервиса ответа. После получения ответа статус заказа меняется на Cancelled или Finished.
3. Что использовалось:
- Для общения между микросервисами использовался grpc + protobuf
- Для реализации паттернов outbox/inbox в качестве очереди сообщений kafka
- Для работы с базами данных использовался Hibernate (после переподключения приложения бд сохраняется, Postgres)
